robots = {}

hub = new Hub

@listen "run robot", ({data: {name: roboname, code: robocode}}, reply) ->
  try
    hub.remove robot[roboname] if robot[roboname]?
    robots[roboname] = hub.add robocode

    reply "robot added", name: roboname
  catch e
    reply "error", e

@listen "kill robot", ({data: {name}}, reply) ->
  if robots[name]
    hub.remove robot[roboname] if robot[roboname]?
    reply "robot killed", name: name
  else
    reply "error", {name, msg: "no such robot"}
