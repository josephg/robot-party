#!/usr/bin/env coffee

fs = require 'fs'
coffeescript = require 'coffee-script'
argv = require('optimist').
	usage("Usage: $0 robot0 robot1 robotN").
	argv

console.log argv._

Robot = require './Robot'
Hub = require './Hub'

hub = new Hub

hub.add ->
	process.on 'uncaughtException', (err) =>
		console.error 'uncaught exception: ' + err.stack
		try @transmit 'uncaught exception', err

for filename in argv._
	do (filename) ->
		robotext = fs.readFile "#{filename}", 'utf8', (err, code) ->
			if err
				console.error "Could not load robot #{filename} : #{err}"
				return

			try
				hub.add code

				console.log "Loaded #{filename}"
			catch e
				console.log "Could not run #{filename}: #{e}"
				return



